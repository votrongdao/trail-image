"use strict";function showPhoto(t,e){if(e&&t){var o=t.getProperty("preview"),a=t.getId(),p=t.getGeometry(),r=t.getProperty("partKey");e.setOptions({content:'<a href="/'+(r||postKey)+"#"+a+'"><img src="'+o+'"/></a>',position:p.get()}),e.open(trip.map)}}function loadPostTrack(t){trip.map.data.forEach(function(t){trip.map.data.remove(t)}),postKey=t,trip.miles=0,trip.hours=0,trip.topSpeed=0,trip.avgSpeed=0,trip.count=0,trip.bounds=new google.maps.LatLngBounds,window.history.pushState(null,null,"/"+postKey+"/map"),trip.map.data.loadGeoJson("/"+postKey+"/geo.json")}function hoursAndMinutes(t){var e=Math.floor(t),o=Math.round(60*(t-e)).toString();return o.length<2&&(o="0"+o),e+":"+o}function encompass(t,e){e instanceof google.maps.LatLng?t.extend(e):e instanceof google.maps.Data.Point?t.extend(e.get()):e.getArray().forEach(function(e){encompass(t,e)})}var trip={timer:0,map:null,bounds:null,miles:0,hours:0,topSpeed:0,avgSpeed:0,count:0,geo:null};google.maps.event.addDomListener(window,"load",function(){var t=document.getElementById("map-canvas"),e=new google.maps.InfoWindow,o=null;trip.bounds=new google.maps.LatLngBounds,trip.map=new google.maps.Map(t,{mapTypeId:google.maps.MapTypeId.HYBRID}),trip.map.data.setStyle(function(t){return parseInt(t.getId())==mapPhotoID&&(o=t),{icon:"/img/orange-marker.png",clickable:t.getGeometry()instanceof google.maps.Data.Point,strokeWeight:3,strokeColor:"#06f",strokeOpacity:.7}}),trip.map.data.addListener("addfeature",function(t){window.clearTimeout(trip.timer),trip.geo=t.feature.getGeometry();var a=0;encompass(trip.bounds,trip.geo),(trip.geo instanceof google.maps.Data.LineString||trip.geo instanceof google.maps.Data.MultiLineString)&&(trip.count++,trip.miles+=t.feature.getProperty("distance"),trip.hours+=t.feature.getProperty("duration"),a=parseFloat(t.feature.getProperty("topSpeed")),a>trip.topSpeed&&(trip.topSpeed=a),a=parseFloat(t.feature.getProperty("avgSpeed")),trip.avgSpeed=(trip.avgSpeed*(trip.count-1)+a)/trip.count),trip.timer=window.setTimeout(function(){trip.map.fitBounds(trip.bounds);var t=$("#summary"),a=$("#gpx-download");window.setTimeout(function(){$("#map-wait").remove()},700),trip.miles>0?(t.show(),allowDownload&&a.show(),$("#distance").html(trip.miles.toFixed(1)),$("#duration").html(hoursAndMinutes(trip.hours)),trip.topSpeed>0?$("#top-speed").html(trip.topSpeed.toFixed(1)):$("#top-speed,#top-speed-label").hide(),trip.avgSpeed>0?$("#avg-speed").html(trip.avgSpeed.toFixed(1)):$("#avg-speed,#avg-speed-label").hide()):t.hide(),o&&showPhoto(o,e)},200)}),trip.map.data.addListener("click",function(t){showPhoto(t.feature,e)}),trip.map.data.addListener("mouseover",function(t){trip.map.data.overrideStyle(t.feature,{icon:"/img/camera-marker.png"})}),trip.map.data.addListener("mouseout",function(){trip.map.data.revertStyle()}),trip.map.data.loadGeoJson("/"+postKey+"/geo.json")});